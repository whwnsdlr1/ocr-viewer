(function(e){function t(t){for(var a,i,s=t[0],c=t[1],l=t[2],d=0,h=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"08a2":function(e,t,n){"use strict";n("b9c1")},"0fe8":function(e,t,n){"use strict";n("a367")},1:function(e,t){},2:function(e,t){},"479e":function(e,t,n){},5291:function(e,t,n){"use strict";n("479e")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"body",attrs:{oncontextmenu:"return false"},on:{dragenter:e.listen__x__ondragenter,dragleave:e.listen__x__ondragleave,dragover:e.listen__x__ondragover,drop:e.listen__x__ondrop}},[n("tool-bar",{ref:"tool-bar",style:{flex:"0 0 124px"},on:{onfilechange:e.listen__tool_bar__onfilechange,onfileerror:e.listen__tool_bar__onfileerror}}),n("div",{staticClass:"sub-body",style:{flex:"1 0 0"}},[n("image-view",{ref:"image-view",style:{flex:"2 0 0"},attrs:{"frame-data":e.$store.state.frameData}}),n("result-view",{style:{flex:"1 0 0"}})],1),n("div",[n("usage-dialog")],1),n("md-snackbar",{attrs:{"md-position":"left","md-duration":2e3,"md-active":e.$store.state.showSnackbar,"md-persistent":""},on:{"update:mdActive":function(t){return e.$set(e.$store.state,"showSnackbar",t)},"update:md-active":function(t){return e.$set(e.$store.state,"showSnackbar",t)}}},[n("span",[e._v(e._s(e.$store.state.messageSnackbar))])]),e.$store.state.showLayer?n("div",{staticClass:"mlayer"},[n("div",[e._m(0),n("span",[e._v(e._s(e.$store.state.messageLayer))])])]):e._e(),e.$store.state.counterDrag>0?n("div",{staticClass:"m-drag-layer"},[e._m(1)]):e._e()],1)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-spinner"},[n("div",{staticClass:"spinner"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("span",[e._v("Drop here")])])}],i=n("1da1"),s=(n("96cf"),n("ac1f"),n("1276"),n("b0c0"),n("d3b7"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","flex-direction":"column"}},[n("div",{staticClass:"upload-panel",staticStyle:{flex:"0 0 76px",background:"#FFFFFF","border-bottom":"1px solid #cacaca",padding:"0px 10px 0px 10px"}},[n("md-field",{staticClass:"md-layout-item"},[n("label",[e._v("upload image")]),n("md-file",{ref:"file",attrs:{placeholder:"click to select image",accept:"image/*"},on:{"md-change":e.listen__file__onchange},model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}})],1)],1),n("div",{staticStyle:{flex:"0 0 48px",display:"flex","flex-direction":"row",background:"#eaeaea",padding:"0px 15px","box-shadow":"0px 3px 3px rgb(0, 0, 0, 30%)","z-index":"1"}},[n("md-switch",{on:{change:e.listen__btn_fitToWindow__onchange},model:{value:e.state.fitToWindow,callback:function(t){e.$set(e.state,"fitToWindow",t)},expression:"state.fitToWindow"}},[e._v("fit to window")])],1)])}),c=[],l=n("2f62"),u={name:"ToolBar",data:function(){return{fileName:"",file:null,state:{fitToWindow:this.fitToWindow}}},methods:{listen__file__onchange:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=this,0!=t.length){e.next=4;break}return n.$emit("onfileerror",{message:"cancel"}),e.abrupt("return");case 4:if(1==t.length){e.next=8;break}return n.$emit("onfileerror",{message:"support only one image input"}),n.$refs.file.clearField(),e.abrupt("return");case 8:if(a=t[0].name.split("."),!(a.length<2)){e.next=13;break}return n.$emit("onfileerror",{message:"only support jpg and png format"}),n.$refs.file.clearField(),e.abrupt("return");case 13:if(r=a[a.length-1].toLowerCase(),"jpg"==r||"jpeg"==r||"png"==r){e.next=18;break}return n.$emit("onfileerror",{message:"only support jpg and png format"}),n.$refs.file.clearField(),e.abrupt("return");case 18:n.fileName!=t[0].name&&(n.fileName=t[0].name),n.$emit("onfilechange",t[0]);case 20:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),listen__btn_fitToWindow__onchange:function(){this.$store.state.fitToWindow!=this.state.fitToWindow&&this.$store.commit("fitToWindow",{value:this.state.fitToWindow})},doubleRaf:function(e){requestAnimationFrame((function(){requestAnimationFrame(e)}))}},computed:Object(l["b"])({fitToWindow:function(e){return e.fitToWindow}}),watch:{fitToWindow:function(){this.state.fitToWindow=this.fitToWindow}}},d=u,h=n("2877"),f=Object(h["a"])(d,s,c,!1,null,"daaf5254",null),m=f.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-view",on:{touchstart:function(t){return e.listen__view__on_x_down(t,"touch")},mousedown:function(t){return e.listen__view__on_x_down(t,"mouse")},mousemove:function(t){return e.listen__view__on_x_move(t,"mouse")},wheel:e.listen__view__onwheel}},[n("frame",{key:1234,ref:"frame",class:"frame-1-1",attrs:{"show-text-area":e.showTextArea,"fit-to-window":e.fitToWindow,"frame-data":e.frameData},on:{onimageload:function(t){return e.$emit("onimageload")}}}),n("div",{staticClass:"layer"},[n("div",{staticClass:"md-fab-wrapper"},[n("md-button",{staticClass:"md-fab md-mini",on:{click:e.listen__btn_usage__onclick}},[n("b",[e._v("?")])])],1)])],1)},p=[],v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"body"})},_=[],w=n("b85c"),x=(n("c740"),n("cb29"),n("2ef0")),y=n.n(x),b=n("89e8"),$=n.n(b),T={props:["frame-data","show-text-area","fit-to-window"],data:function(){return{imageLayerId:void 0,loaded:!1,state:{coord:{x:0,y:0},zoom:void 0,voi:{windowCenter:127,windowWidth:256}},internalState:{moveTouch:void 0,zoomTouch:void 0},style:{boxColor:"#FFFF00",highlightBoxColor:"#FF0000"}}},methods:{listen__x__onresize:function(){var e=this;if(0==e.frameData._empty){var t=getComputedStyle(this.$el),n=parseInt(t.height)/this.frameData.cornerstoneImage.height,a=parseInt(t.width)/this.frameData.cornerstoneImage.width,r=n<a?n:a;if(Math.abs(this.state.zoom-r)>1e-5){e.$cornerstone.resize(e.$el,!1),this.$store.commit("fitToWindow",{value:!1});for(var o=this.$cornerstone.getLayers(this.$el),i=0;i<o.length;i++){var s=o[i].viewport;s.scale=e.state.zoom,s.translation.x=e.state.coord.x,s.translation.y=e.state.coord.y}this.$cornerstone.updateImage(this.$el)}}},listen__view__on_x_down:function(e,t){var n,a,r,o=this;0!=o.loaded&&(void 0!=o.state.coord&&(e.preventDefault(),"touch"==t&&0==e.which?void 0!=o.internalState.moveTouch?(o.internalState.zoomTouch=o.copyTouch(e.changedTouches[0]),v()):(o.internalState.moveTouch=o.copyTouch(e.changedTouches[0]),n=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY,p()):"mouse"==t&&1==e.which?(n=e.pageX,a=e.pageY,m()):"mouse"==t&&3==e.which&&(n=e.pageX,a=e.pageY,g())));function i(e){1==e.which&&(o.$parent.$el.removeEventListener("mousemove",u),o.$parent.$el.removeEventListener("mouseup",i))}function s(e){3==e.which&&(o.$parent.$el.removeEventListener("mousemove",d),o.$parent.$el.removeEventListener("mouseup",s))}function c(e){-1!=Array.prototype.findIndex.call(e.changedTouches,(function(e){return e.identifier==o.internalState.moveTouch.identifier}))&&(o.internalState.moveTouch=void 0,o.$parent.$el.removeEventListener("touchmove",h),o.$parent.$el.removeEventListener("touchend",c))}function l(e){-1!=Array.prototype.findIndex.call(e.changedTouches,(function(e){return e.identifier==o.internalState.zoomTouch.identifier}))&&(o.internalState.zoomTouch=void 0,o.$parent.$el.removeEventListener("touchmove",f),o.$parent.$el.removeEventListener("touchend",l))}function u(e){var t=e.pageX-n,r=e.pageY-a;n=e.pageX,a=e.pageY;var i=o.state.coord.x+t/o.state.zoom,s=o.state.coord.y+r/o.state.zoom;o.listen__state__tochange({coord:{x:i,y:s}},!1)}function d(e){var t=e.pageX-n,r=e.pageY-a;n=e.pageX,a=e.pageY;var i=Math.min(256,Math.max(1,o.state.voi.windowWidth+t/o.state.zoom)),s=Math.min(255,Math.max(0,o.state.voi.windowCenter+r/o.state.zoom));o.listen__state__tochange({voi:{windowWidth:i,windowCenter:s}},!1)}function h(e){var t=Array.prototype.findIndex.call(e.changedTouches,(function(e){return e.identifier==o.internalState.moveTouch.identifier}));if(-1!=t){var r=e.changedTouches[t],i=r.pageX-n,s=r.pageY-a;if(n=r.pageX,a=r.pageY,void 0==o.internalState.zoomTouch){var c=o.state.coord.x+i/o.state.zoom,l=o.state.coord.y+s/o.state.zoom;o.listen__state__tochange({coord:{x:c,y:l}},!1)}}}function f(e){var t=Array.prototype.findIndex.call(e.changedTouches,(function(e){return e.identifier==o.internalState.zoomTouch.identifier}));if(void 0!=o.internalState.moveTouch&&-1!=t){var n=e.changedTouches[t],a=2.5*(Math.abs(n.pageX-o.internalState.moveTouch.pageX)+Math.abs(n.pageY-o.internalState.moveTouch.pageY))/(window.innerHeight+window.innerWidth);if(void 0!=r){var i=a-r;r=a;var s=o.state.zoom+i;s>0&&o.listen__state__tochange({zoom:s},!1)}else r=a}}function m(){o.$parent.$el.addEventListener("mousemove",u),o.$parent.$el.addEventListener("mouseup",i)}function g(){o.$parent.$el.addEventListener("mousemove",d),o.$parent.$el.addEventListener("mouseup",s)}function p(){o.$parent.$el.addEventListener("touchmove",h),o.$parent.$el.addEventListener("touchend",c)}function v(){o.$parent.$el.addEventListener("touchmove",f),o.$parent.$el.addEventListener("touchend",l)}},listen__view__on_x_move:function(e){var t=this;if(0!=t.loaded&&void 0!=t.state.coord&&0!=this.$store.state.frameData.pred.length){e.preventDefault();var n=this.$cornerstone.canvasToPixel(this.$el,{x:e.offsetX,y:e.offsetY}),a=new Array(this.$store.state.frameData.pred.length),r=new Array(this.$store.state.frameData.pred.length).fill(!1);for(var o in this.$store.state.frameData.pred){var i=this.$store.state.frameData.pred[o];a[o]=i.id,1==t.testPolygon(n,i.points)&&(r[o]=!0)}for(var s in r)1==r[s]?this.$store.commit("frameDataPred",{id:a[s],key:"highlight",value:!0}):this.$store.commit("frameDataPred",{id:a[s],key:"highlight",value:!1});this.$store.commit("updateTagging")}},listen__view__onwheel:function(e){var t=this;if(0!=t.loaded&&void 0!=t.state.zoom){var n=e.wheelDelta<0||e.detail>0||e.deltaY>=0?-.1:.1,a=t.state.zoom+n;return a>0&&t.listen__state__tochange({zoom:a},!1),!1}},listen__state__tochange:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];function n(){return a.apply(this,arguments)}function a(){return a=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:void 0!=e.coord&&(r.state.coord={x:e.coord.x,y:e.coord.y}),void 0!=e.zoom&&(r.state.zoom=e.zoom),void 0!=e.voi&&(r.state.voi={windowCenter:e.voi.windowCenter,windowWidth:e.voi.windowWidth});case 3:case"end":return t.stop()}}),t)}))),a.apply(this,arguments)}var r=this;1==t?(r.layer.message="update state...",r.layer.active=!0,r.doubleRaf(n)):n(),r.$emit("onstatechange",e)},updateTagging:function(){if(1==this.loaded&&0==this.frameData._empty){this.$cornerstoneTools.clearToolState(this.$el,"FreehandRoi");var e,t=Object(w["a"])(this.$store.state.frameData.pred);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(0!=n.active){var a,r=[],o=Object(w["a"])(n.points);try{for(o.s();!(a=o.n()).done;){var i=a.value;r.push({x:i.x,y:i.y,highlight:!1,active:!1,lines:[]})}}catch(c){o.e(c)}finally{o.f()}r.push({x:r[0].x,y:r[0].y,highlight:!1,active:!1,lines:[]});var s={visiable:!0,active:!1,invalidated:!0,color:n.highlight?this.style.highlightBoxColor:this.style.boxColor,handles:{points:r,textBox:{freehand:!0,active:!1,hasMoved:!1,movesIndependently:!1,drawIndependently:!0,allowOutsideImage:!0,hasBoundingBox:!0}}};this.$cornerstoneTools.addToolState(this.$el,"FreehandRoi",s)}}}catch(c){t.e(c)}finally{t.f()}this.$cornerstone.updateImage(this.$el)}},testPolygon:function(e,t){for(var n=e.x,a=e.y,r=!1,o=0,i=t.length-1;o<t.length;i=o++){var s=t[o].x,c=t[o].y,l=t[i].x,u=t[i].y,d=c>a!=u>a&&n<(l-s)*(a-c)/(u-c)+s;d&&(r=!r)}return r}},computed:{},watch:{"state.coord":function(e){if(1==this.loaded&&0==this.frameData._empty&&void 0!=e){var t=this.$cornerstone.getLayers(this.$el);(Math.abs(e.x)>1e-5||Math.abs(e.y)>1e-5)&&this.$store.commit("fitToWindow",{value:!1});for(var n=0;n<t.length;n++){var a=t[n].viewport;a.translation.x=e.x,a.translation.y=e.y}this.$cornerstone.updateImage(this.$el)}},"state.zoom":function(e){if(1==this.loaded&&0==this.frameData._empty&&void 0!=e){var t=getComputedStyle(this.$el),n=parseInt(t.height)/this.frameData.cornerstoneImage.height,a=parseInt(t.width)/this.frameData.cornerstoneImage.width,r=n<a?n:a;Math.abs(e-r)>1e-5&&this.$store.commit("fitToWindow",{value:!1});for(var o=this.$cornerstone.getLayers(this.$el),i=0;i<o.length;i++){var s=o[i].viewport;s.scale=e}this.$cornerstone.updateImage(this.$el)}},"state.voi":function(e){if(1==this.loaded&&0==this.frameData._empty){var t=this.$cornerstone.getLayer(this.$el,this.imageLayerId);t.viewport.voi.windowWidth=e.windowWidth,t.viewport.voi.windowCenter=e.windowCenter,this.$cornerstone.updateImage(this.$el)}},"frameData._empty":function(e){if(0==e){this.$cornerstone.enable(this.$el),$()(this.$el,y.a.debounce(this.listen__x__onresize,10));var t=this.frameData.cornerstoneImage,n=this.$cornerstone.getDefaultViewport(this.$el,t),a=getComputedStyle(this.$el),r=parseInt(a.height)/t.height,o=parseInt(a.width)/t.width;this.state={coord:{x:0,y:0},zoom:r<o?r:o,voi:{windowCenter:127,windowWidth:256}},n.scale=this.state.zoom,n.translation.y=this.state.coord.y,n.translation.x=this.state.coord.x,n.voi.windowCenter=this.state.voi.windowCenter,n.voi.windowWidth=this.state.voi.windowWidth;var i=this.$cornerstone.addLayer(this.$el,this.frameData.cornerstoneImage,{viewport:n});this.imageLayerId=i,this.loaded=!0,this.$store.commit("fitToWindow",{value:!0});var s=this.$cornerstoneTools.FreehandRoiTool;this.$cornerstoneTools.addToolForElement(this.$el,s),this.$cornerstoneTools.setToolEnabledForElement(this.$el,"FreehandRoi",{mouseButtonMask:2}),this.$store.commit("updateTagging")}else this.loaded=!1,$.a.unbind(this.$el),this.$cornerstone.disable(this.$el)},"$store.state.fitToWindow":function(e){if(1==this.loaded&&0==this.frameData._empty&&1==e){var t=getComputedStyle(this.$el),n=parseInt(t.height)/this.frameData.cornerstoneImage.height,a=parseInt(t.width)/this.frameData.cornerstoneImage.width;this.state.coord={x:0,y:0},this.state.zoom=n<a?n:a}},"$store.state.updateTagging":function(){this.updateTagging()}}},D=T,k=(n("5291"),Object(h["a"])(D,v,_,!1,null,"8df8edc4",null)),S=k.exports,C={props:{frameData:Object,showTextArea:Boolean,fitToWindow:Boolean},components:{Frame:S},methods:{listen__btn_usage__onclick:function(){this.$store.commit("usageDialog",{value:!0})},listen__view__on_x_down:function(e,t){this.$refs["frame"].listen__view__on_x_down(e,t)},listen__view__onwheel:function(e){this.$refs["frame"].listen__view__onwheel(e)},listen__view__on_x_move:function(e,t){this.$refs["frame"].listen__view__on_x_move(e,t)}}},I=C,L=(n("08a2"),Object(h["a"])(I,g,p,!1,null,"11ab290c",null)),R=L.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"result-view"},[n("div",{staticStyle:{flex:"0 0 10px"}}),e._m(0),n("div",{staticClass:"w-search"},[n("md-field",{attrs:{"md-inline":""}},[n("md-icon",[e._v("search")]),n("label",[e._v("search...")]),n("md-input",{on:{input:e.listen__search__oninput}})],1)],1),n("div",{staticStyle:{flex:"0 0 5px"}}),n("transition-group",{staticClass:"text-area",staticStyle:{flex:"1 0 0"},attrs:{name:"staggered-fade",tag:"div",css:!0},on:{"before-enter":e.beforeEnter,enter:e.enter,leave:e.leave}},e._l(e.searchTexts,(function(t){return n("BadgeText",{key:t.id,attrs:{data:t},on:{ontoggle:e.listen__badge__ontoggle}})})),1)],1)},W=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header"},[n("div",{staticClass:"row1"},[n("h3",[e._v("Text")])])])}],O=(n("fb6a"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"badge",class:{highlight:e.data.highlight},on:{click:e.listen__div__onclick}},[e._v(" "+e._s(e.data.text)+" "),n("md-tooltip",{attrs:{"md-direction":"top"}},[e._v("id: "+e._s(e.data.id)+", prob: "+e._s(e.data.prob.toFixed(3)))])],1)}),z=[],E={props:["data"],data:function(){return{}},methods:{listen__div__onclick:function(){this.$emit("ontoggle",{id:this.data.id})}}},P=E,A=(n("68a0"),Object(h["a"])(P,O,z,!1,null,"1999fc88",null)),F=A.exports,B=n("589d"),M=n.n(B),U={components:{BadgeText:F},data:function(){return{state:{searchText:null,activeIds:[]},debouncedInput:"",timeout:null}},methods:{listen__search__oninput:y.a.debounce((function(e){this.state.searchText=e}),300),listen__badge__ontoggle:function(e){var t,n=Object(w["a"])(this.searchTexts);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.id==e.id&&(a.highlight=!a.highlight,this.$store.commit("frameDataPred",{id:a.id,key:"highlight",value:a.highlight}))}}catch(r){n.e(r)}finally{n.f()}this.$store.commit("updateTagging")},beforeEnter:function(e){e.style.opacity=0},enter:function(e,t){var n=150*e.dataset.index;setTimeout((function(){M()(e,{opacity:1},{complete:t})}),n)},leave:function(e,t){var n=150*e.dataset.index;setTimeout((function(){M()(e,{opacity:0},{complete:t})}),n)}},computed:{texts:function(){return this.$store.state.frameData.pred},searchTexts:function(){if(0==this.texts.length)return[];if(null==this.state.searchText||0==this.state.searchText.length)return this.texts.slice();var e,t=[],n=Object(w["a"])(this.texts);try{for(n.s();!(e=n.n()).done;){var a=e.value;-1!=a.text.indexOf(this.state.searchText)&&t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},watch:{searchTexts:function(){var e,t=this,n=Object(w["a"])(this.texts);try{var a=function(){var n=e.value,a=t.searchTexts.findIndex((function(e){return n.id==e.id}));-1!=a?(t.$store.commit("frameDataPred",{id:n.id,key:"active",value:!0}),t.$store.commit("frameDataPred",{id:n.id,key:"highlight",value:t.searchTexts[a].highlight})):(t.$store.commit("frameDataPred",{id:n.id,key:"active",value:!1}),t.$store.commit("frameDataPred",{id:n.id,key:"highlight",value:!1}))};for(n.s();!(e=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}this.$store.commit("updateTagging")}}},Y=U,N=(n("0fe8"),Object(h["a"])(Y,j,W,!1,null,"c146d502",null)),X=N.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("md-dialog-confirm",{attrs:{"md-active":e.active,"md-title":"Control","md-content":"<b>Pan:</b> PC - left mouse drag / Mobile - touch drag<br />\r\n<b>Zoom:</b> PC - middle mouse, or mousewheel / Mobile - two-finger spread or squish<br />\r\n<b>Change reference image:</b> left mouse doubleclick<br />\r\n<b>Adjust Brightness:</b> right mouse drag along a vertical axis<br />\r\n<b>Adjust Contrast:</b> right mouse drag along a horizontal axis","md-confirm-text":"OK","md-cancel-text":""},on:{"md-cancel":e.listen__btn_close__onclick,"md-confirm":e.listen__btn_close__onclick}})},J=[],H={data:function(){return{}},methods:{listen__btn_close__onclick:function(){this.$store.state.usageDialog=!this.$store.state.usageDialog}},computed:{active:function(){return this.$store.state.usageDialog}}},q=H,V=Object(h["a"])(q,G,J,!1,null,null,null),K=V.exports,Z=(n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("8a79"),n("eed2")),Q=n.n(Z),ee=n("fcd8"),te=n.n(ee);function ne(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t(n.target.result);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readAsArrayBuffer(e)}))}function ae(e){return new Promise((function(t,n){try{var a=new Uint8Array(e),r=Q.a.decode(a,!0);t({pixelData:r.data,width:r.width,height:r.height})}catch(o){n(o)}}))}function re(e){return new Promise((function(t,n){var a=new Uint8Array(e);new te.a.PNG({filterType:4}).parse(a,function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{null!=a&&n(a),t({pixelData:r.data,width:r.width,height:r.height})}catch(o){n(o)}case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}))}function oe(e,t){return ie.apply(this,arguments)}function ie(){return ie=Object(i["a"])(regeneratorRuntime.mark((function e(t,n){var a,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t instanceof Blob){e.next=2;break}throw new Error("blob must be a instance of Blob");case 2:if("string"==typeof n){e.next=4;break}throw new Error("extension must be a type of string");case 4:if(!n.toLowerCase().endsWith("jpg")&&!n.toLowerCase().endsWith("jpeg")){e.next=13;break}return e.next=7,ne(t);case 7:return r=e.sent,e.next=10,ae(r);case 10:a=e.sent,e.next=23;break;case 13:if(!n.toLowerCase().endsWith("png")){e.next=22;break}return e.next=16,ne(t);case 16:return o=e.sent,e.next=19,re(o);case 19:a=e.sent,e.next=23;break;case 22:throw new Error("unsupported extension");case 23:return e.abrupt("return",a);case 24:case"end":return e.stop()}}),e)}))),ie.apply(this,arguments)}var se={parseImage:oe,parsePng:re,parseJpg:ae};n("25f0"),n("8a59"),n("5319"),n("a9e3"),n("99af");function ce(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear();return t<10&&(t="0"+t),n<10&&(n="0"+n),a+"."+n+"."+t}function le(){var e,t="";for(e=0;e<32;e+=1)switch(e){case 8:case 20:t+="-",t+=(16*Math.random()|0).toString(16);break;case 12:t+="-",t+="4";break;case 16:t+="-",t+=(4*Math.random()|8).toString(16);break;default:t+=(16*Math.random()|0).toString(16)}return t}function ue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n["parent"],r=n["id"],o=n["class"],i=n["text"],s=n["innerHTML"],c=n["attrs"],l=document.createElement(e);for(var u in t)l.style[u]=t[u];if(void 0!==a&&a.appendChild(l),void 0!==r&&(l.id=r),void 0!==o&&(l.className=o),void 0!==i&&(l.textContent=i),void 0!==s&&(l.innerHTML=s),void 0!==c)for(var d in c)l.setAttribute(d,c[d]);return l}function de(e){if(e.length>0){for(var t=0,n=e[0],a=1;a<e.length;a++){var r=e[a];r>n&&(n=r,t=a)}return t}return-1}function he(e,t,n,a,r){var o=document.createElement("canvas"),i=o.getContext("2d"),s=document.createElement("canvas"),c=s.getContext("2d");return o.width=t,o.height=n,i.putImageData(new ImageData(new Uint8ClampedArray(e),t,n),0,0),s.width=a,s.height=r,c.drawImage(o,0,0,o.width,o.height,0,0,s.width,s.height),c.getImageData(0,0,a,r).data}function fe(e){for(var t,n,a,r,o,i="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(e.buffer),l=c.byteLength,u=l%3,d=l-u,h=0;h<d;h+=3)o=c[h]<<16|c[h+1]<<8|c[h+2],t=(16515072&o)>>18,n=(258048&o)>>12,a=(4032&o)>>6,r=63&o,i+=s[t]+s[n]+s[a]+s[r];return 1===u?(o=c[d],t=(252&o)>>2,n=(3&o)<<4,i+=s[t]+s[n]+"=="):2===u&&(o=c[d]<<8|c[d+1],t=(64512&o)>>10,n=(1008&o)>>4,a=(15&o)<<2,i+=s[t]+s[n]+s[a]+"="),i}function me(e){for(var t=atob(e),n=t.length,a=new Uint8Array(n),r=0;r<n;r++)a[r]=t.charCodeAt(r);return a.buffer}function ge(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;n++){var a=4*n,r=e[n];t[a]=r,t[a+1]=r,t[a+2]=r,t[a+3]=255}return t}function pe(e){for(var t=new Uint8Array(e.length/3*4),n=0;n<e.length;n+=3){var a=n/3*4;t[a]=e[n],t[a+1]=e[n+1],t[a+2]=e[n+2],t[a+3]=255}return t}function ve(e){for(var t=e.length/3,n=new Uint8Array(4*t),a=0;a<t;a++){var r=4*a;n[r]=e[a],n[r+1]=e[a+t],n[r+2]=e[a+t+t],n[r+3]=255}return n}function _e(e){for(var t=new Uint8Array(e.length/4*3),n=0;n<e.length;n+=4){var a=n/4*3;t[a]=e[n],t[a+1]=e[n+1],t[a+2]=e[n+2]}return t}function we(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(function(e,t,n,a){return t+t+n+n+a+a}));var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function xe(e,t,n){function a(e){var t=Number(e).toString(16);return t.length<2&&(t="0".concat(t)),t}return"#".concat(a(e)).concat(a(t)).concat(a(n)).toUpperCase()}var ye={getDateString:ce,getUuid4:le,createElement:ue,argMax:de,resizeImg:he,convertBufferToBase64:fe,convertBase64ToBuffer:me,convertGRAY2RGBA:ge,convertRGB2RGBA:pe,convertRGB2RGBA1:ve,convertRGBA2RGB:_e,convertHexToRgb:we,convertRgbToHex:xe},be=function(e){return new Promise((function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){return t(a.result)},a.onerror=function(e){return n(e)}}))};function $e(e){return new Promise((function(t,n){var a=new WebSocket("ws://localhost:8999");a.onopen=function(t){a.send(JSON.stringify({data:e}))},a.onclose=function(e){1e3!=e.code&&n("failed to recognize. "+e.code)},a.onerror=function(e){n("could't connect to websocket server. Check the readme / Demo tab."),a.close()},a.onmessage=function(e){var r=JSON.parse(e.data);0==r.code?t(r.result):n("failed to recognize."),a.close()}}))}function Te(e){return De.apply(this,arguments)}function De(){return De=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,a,r,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,be(t);case 2:return n=e.sent,e.next=5,$e(n);case 5:for(o in a=e.sent,r=[],a)i=a[o],r.push({id:o,text:i[1],prob:i[2],active:!0,highlight:!1,points:[{x:i[0][0][0],y:i[0][0][1]},{x:i[0][1][0],y:i[0][1][1]},{x:i[0][2][0],y:i[0][2][1]},{x:i[0][3][0],y:i[0][3][1]}]});return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}var ke={recognize:Te},Se={name:"App",data:function(){return{}},components:{ToolBar:m,ImageView:R,ResultView:X,UsageDialog:K},methods:{listen__x__ondragenter:function(e){e.preventDefault(),this.$store.commit("counterDrag",{op:"increment"})},listen__x__ondragleave:function(e){e.preventDefault(),this.$store.commit("counterDrag",{op:"decrement"})},listen__x__ondragover:function(e){e.preventDefault()},listen__x__ondrop:function(e){e.preventDefault(),this.$store.commit("counterDrag",{op:"clear"}),this.$refs["tool-bar"].listen__file__onchange(e.dataTransfer.files)},listen__tool_bar__onfilechange:function(e){var t=this;0==t.$store.state.frameData._empty&&t.$store.commit("frameData",{value:{id:ye.getUuid4(),_empty:!0,pred:[]}}),t.$store.commit("showLayer",{value:!0}),t.doubleRaf(Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r,o,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$store.commit("messageLayer",{value:"parse image..."}),r=e.name.split("."),o=r[r.length-1].toLowerCase(),n.prev=3,n.next=6,se.parseImage(e,o);case 6:a=n.sent,n.next=16;break;case 9:return n.prev=9,n.t0=n["catch"](3),console.log(n.t0),t.showSnackbar({message:"image parsing failure"}),t.$refs["tool-bar"].$refs.file.clearField(),t.$store.commit("showLayer",{value:!1}),n.abrupt("return");case 16:return n.next=18,t.$cornerstone.createCornerstoneImageRgba(void 0,a.pixelData,a.width,a.height);case 18:return i=n.sent,t.$store.commit("messageLayer",{value:"recognize..."}),n.prev=20,n.next=23,ke.recognize(e);case 23:s=n.sent,console.log(s),n.next=34;break;case 27:return n.prev=27,n.t1=n["catch"](20),console.log(n.t1),t.showSnackbar({message:n.t1}),t.$refs["tool-bar"].$refs.file.clearField(),t.$store.commit("showLayer",{value:!1}),n.abrupt("return");case 34:t.$store.commit("frameData",{value:{id:ye.getUuid4(),name:e.name,cornerstoneImage:i,_empty:!1,pred:s}}),t.$store.commit("showLayer",{value:!1});case 36:case"end":return n.stop()}}),n,null,[[3,9],[20,27]])}))))},listen__tool_bar__onfileerror:function(e){console.log(e);var t=this;0==t.$store.state.frameData._empty&&t.$store.commit("frameData",{value:{id:ye.getUuid4(),_empty:!0,pred:[]}}),this.showSnackbar(e)},showSnackbar:function(e){this.$store.commit("messageSnackbar",{value:e.message}),this.$store.commit("showSnackbar",{value:!0}),this.$store.commit("showLayer",{value:!1})},doubleRaf:function(e){requestAnimationFrame((function(){requestAnimationFrame(e)}))},fetchBlob:function(e){return new Promise((function(t){fetch(e).then((function(e){return e.blob()})).then((function(e){t(e)}))}))},sleep:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e,n.$store.commit("showLayer",{value:!0}),n.doubleRaf(Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.$store.commit("messageLayer",{value:"demo using stub data..."}),t.prev=1,t.next=4,e.fetchBlob("https://live.staticflickr.com/288/32317432425_69f0f7536f_c_d.jpg");case 4:return r=t.sent,t.next=7,se.parseImage(r,"jpg");case 7:a=t.sent,t.next=16;break;case 10:return t.prev=10,t.t0=t["catch"](1),n.showSnackbar({message:"fail to get flickr image"}),n.$refs["tool-bar"].$refs.file.clearField(),n.$store.commit("showLayer",{value:!1}),t.abrupt("return");case 16:return t.next=18,n.$cornerstone.createCornerstoneImageRgba(void 0,a.pixelData,a.width,a.height);case 18:return o=t.sent,i=JSON.parse('[{"id":"0","text":"Cruis","prob":0.9962915182113647,"active":true,"highlight":false,"points":[{"x":458,"y":166},{"x":518,"y":120},{"x":537,"y":144},{"x":478,"y":190}]},{"id":"1","text":"Jungle","prob":0.917414665222168,"active":true,"highlight":false,"points":[{"x":386,"y":220},{"x":449,"y":169},{"x":469,"y":193},{"x":405,"y":244}]},{"id":"2","text":"Market Oisice","prob":0.9108983278274536,"active":true,"highlight":false,"points":[{"x":132,"y":231},{"x":343,"y":286},{"x":336,"y":312},{"x":125,"y":257}]},{"id":"3","text":"Station","prob":0.9994226098060608,"active":true,"highlight":false,"points":[{"x":448,"y":243},{"x":543,"y":184},{"x":561,"y":213},{"x":467,"y":272}]},{"id":"4","text":"Train","prob":0.9985295534133911,"active":true,"highlight":false,"points":[{"x":396,"y":282},{"x":452,"y":242},{"x":468,"y":265},{"x":412,"y":305}]},{"id":"5","text":"TicketBox","prob":0.9949602484703064,"active":true,"highlight":false,"points":[{"x":400,"y":346},{"x":530,"y":279},{"x":546,"y":309},{"x":416,"y":376}]},{"id":"6","text":"Market","prob":0.9998836517333984,"active":true,"highlight":false,"points":[{"x":213,"y":393},{"x":327,"y":373},{"x":331,"y":398},{"x":217,"y":418}]},{"id":"7","text":"ChairLift","prob":0.9827647805213928,"active":true,"highlight":false,"points":[{"x":405,"y":416},{"x":530,"y":359},{"x":547,"y":394},{"x":421,"y":451}]},{"id":"8","text":"Cariblcan","prob":0.877497673034668,"active":true,"highlight":false,"points":[{"x":262,"y":427},{"x":335,"y":414},{"x":338,"y":432},{"x":265,"y":444}]}]'),n.$store.commit("frameData",{value:{id:ye.getUuid4(),name:"stub.png",cornerstoneImage:o,_empty:!1,pred:i}}),e.$refs["tool-bar"].fileName="stub.data",t.next=24,e.sleep(2e3);case 24:n.$store.commit("showLayer",{value:!1});case 25:case"end":return t.stop()}}),t,null,[[1,10]])}))));case 3:case"end":return t.stop()}}),t)})))()}},Ce=Se,Ie=(n("034f"),Object(h["a"])(Ce,r,o,!1,null,null,null)),Le=Ie.exports;a["default"].use(l["a"]);var Re={usageDialog:!1,showSnackbar:!1,messageSnackbar:"",showLayer:!1,counterDrag:0,messageLayer:"",fitToWindow:!1,frameData:{_uid:ye.getUuid4(),_empty:!0,pred:[]},updateTagging:0},je={usageDialog:function(e,t){e.usageDialog=t.value},showSnackbar:function(e,t){e.showSnackbar=t.value},messageSnackbar:function(e,t){e.messageSnackbar=t.value},showLayer:function(e,t){e.showLayer=t.value},counterDrag:function(e,t){"increment"==t.op?e.counterDrag++:"decrement"==t.op?e.counterDrag--:"clear"==t.op&&(e.counterDrag=0)},messageLayer:function(e,t){e.messageLayer=t.value},fitToWindow:function(e,t){e.fitToWindow=t.value},frameData:function(e,t){e.frameData=t.value},frameDataPred:function(e,t){var n,a=Object(w["a"])(e.frameData.pred);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.id==t.id&&(r[t.key]=t.value)}}catch(o){a.e(o)}finally{a.f()}},updateTagging:function(e){e.updateTagging++}},We=new l["a"].Store({state:Re,mutations:je}),Oe={store:We},ze=n("43f9"),Ee=n.n(ze),Pe=(n("51de"),n("e094"),n("81d9")),Ae=n.n(Pe);function Fe(){var e,t="";for(e=0;e<32;e+=1)switch(e){case 8:case 20:t+="-",t+=(16*Math.random()|0).toString(16);break;case 12:t+="-",t+="4";break;case 16:t+="-",t+=(4*Math.random()|8).toString(16);break;default:t+=(16*Math.random()|0).toString(16)}return t}function Be(e,t){var n=t.width,a=t.height,r=t.pixelData,o=255,i=n*a*4,s=Ae.a.renderColorImage,c={imageId:e,minPixelValue:0,maxPixelValue:o,slope:1,intercept:0,windowCenter:127,windowWidth:256,render:s,getPixelData:function(){return r},rows:a,columns:n,height:a,width:n,color:!0,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:i};return{promise:new Promise((function(e){e(c)})),cancelFn:void 0}}var Me={install:function(e){function t(e,t,n,a){return new Promise((function(r){e=void 0==e?Fe():e,Ae.a.loadImage("rgbaLoader:".concat(e),{pixelData:t,width:n,height:a}).then((function(e){r(e)}))}))}Ae.a.registerImageLoader("rgbaLoader",Be),e.prototype.$cornerstone=Ae.a,e.prototype.$cornerstone.createCornerstoneImageRgba=t}},Ue=n("c8b5"),Ye=n.n(Ue),Ne=n("6e43"),Xe=n.n(Ne),Ge=n("e6ad"),Je=n.n(Ge),He={install:function(e){Je.a.toolStyle.setToolWidth(2),Je.a.external.cornerstone=Ae.a,Je.a.external.Hammer=Ye.a,Je.a.external.cornerstoneMath=Xe.a,Je.a.init(),e.prototype.$cornerstoneTools=Je.a}};a["default"].use(l["a"]),a["default"].use(Ee.a),a["default"].use(Me),a["default"].use(He),a["default"].config.productionTip=!1,new a["default"]({store:Oe.store,render:function(e){return e(Le)}}).$mount("#app")},"68a0":function(e,t,n){"use strict";n("ace5")},"85ec":function(e,t,n){},a367:function(e,t,n){},ace5:function(e,t,n){},b9c1:function(e,t,n){}});
//# sourceMappingURL=app.a4174cf2.js.map